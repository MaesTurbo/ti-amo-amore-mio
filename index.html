<script>
  const confetti = window.confetti.create(document.getElementById('confetti'), {
    resize: true,
    useWorker: true
  });

  function randomBetween(min, max) {
    return Math.random() * (max - min) + min;
  }

  function fireworkHeartAt(x, y, scale = 1, colors = ['#ff4466', '#ff6699', '#ff2255']) {
    const count = 100;
    const angleStep = (2 * Math.PI) / count;

    for (let i = 0; i < count; i++) {
      let t = i * angleStep;
      // Forma cuore parametrica (valori base)
      let heartX = 16 * Math.pow(Math.sin(t), 3);
      let heartY = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);

      confetti({
        particleCount: 1,
        startVelocity: randomBetween(10, 30) * scale,
        spread: 20,
        origin: {
          x: (x + heartX * scale) / window.innerWidth,
          y: (y - heartY * scale) / window.innerHeight,
        },
        colors: colors,
        ticks: 100,
        shapes: ['circle'],
        scalar: randomBetween(0.4, 1.2) * scale
      });
    }
  }

  function randomColorSet() {
    const colorSets = [
      ['#ff4466', '#ff6699', '#ff2255'],  // rosa
      ['#4fc3f7', '#81d4fa', '#0288d1'],  // azzurro
      ['#ffeb3b', '#fff176', '#fbc02d'],  // giallo
      ['#4caf50', '#81c784', '#388e3c']   // verde
    ];
    return colorSets[Math.floor(Math.random() * colorSets.length)];
  }

  function launchRandomFireworks() {
    const x = randomBetween(0, window.innerWidth);
    const y = randomBetween(0, window.innerHeight);
    const scale = randomBetween(0.5, 1.5);
    const colors = randomColorSet();
    fireworkHeartAt(x, y, scale, colors);
  }

  // Lancia fuochi d'artificio a intervalli casuali tra 500ms e 2500ms
  function startRandomFireworks() {
    launchRandomFireworks();
    const next = randomBetween(500, 2500);
    setTimeout(startRandomFireworks, next);
  }

  startRandomFireworks();
</script>
